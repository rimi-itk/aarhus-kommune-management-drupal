<?php

/**
 * @file
 * Tests for aarhus_kommune_management.
 */

/**
 *
 */
class AarhusKommuneManagementUserTestCase extends SiteTesting {

  /**
   * {@inheritdoc}
   */
  public static function getInfo() {
    return [
      'name' => 'Aarhus kommune management',
      'description' => 'Test user management.',
      'group' => 'Aarhus kommune management',
    ];
  }

  /**
   * Get users.
   */
  public function testGetUsers() {
    $this->authenticate();
    $result = $this->get('aarhus-kommune-management/users');

    $this->assertEqual(['data' => []], $result);
  }

  /**
   * Create user.
   */
  public function testCreateUser() {
    $this->authenticate();

    $result = $this->post(
      'aarhus-kommune-management/users',
      [
        'json' => [
          'users' => [
            'create' => [
              [
                'uuid' => 'user:001',
                'email-address' => 'user001@example.com',
              ],
            ],
          ],
        ],
      ]
    );

    $this->assertTrue(isset($result['users']['create'][0]));
    $this->assertEqual($result['users']['create'][0], ['user:001' => 'Do not know how to create user']);
  }

  /**
   * Update user.
   */
  public function testUpdateUser() {
    $this->authenticate();

    $result = $this->post(
      'aarhus-kommune-management/users',
      [
        'json' => [
          'users' => [
            'update' => [
              [
                'uuid' => 'user:001',
                'email-address' => 'user001@example.com',
              ],
            ],
          ],
        ]
      ]);

    $this->assertTrue(isset($result['users']['update'][0]));
    $this->assertEqual($result['users']['update'][0], ['user:001' => 'No such user']);
  }

  /**
   * Delete user.
   */
  public function testDeleteUser() {
    $this->authenticate();

    $result = $this->post(
      'aarhus-kommune-management/users',
      [
        'json' => [
          'users' => [
            'delete' => [
              [
                'uuid' => 'user:001',
              ],
            ],
          ],
        ]
      ]);

    $this->assertTrue(isset($result['users']['delete'][0]));
    $this->assertEqual($result['users']['delete'][0], ['user:001' => 'No such user']);
  }

  /**
   * Delete user.
   */
  public function testBatch() {
    $this->authenticate();

    $result = $this->post(
      'aarhus-kommune-management/users',
      [
        'json' => [
          'users' => [
            'create' => [
              [
                'uuid' => 'user:003',
              ],
            ],
            'update' => [
              [
                'uuid' => 'user:002',
              ],
            ],
            'delete' => [
              [
                'uuid' => 'user:001',
              ],
            ],
          ],
        ]
      ]);

    $this->assertTrue(isset($result['users']['create'][0]));
    $this->assertEqual($result['users']['create'][0], ['user:003' => 'Do not know how to create user']);

    $this->assertTrue(isset($result['users']['update'][0]));
    $this->assertEqual($result['users']['update'][0], ['user:002' => 'No such user']);

    $this->assertTrue(isset($result['users']['delete'][0]));
    $this->assertEqual($result['users']['delete'][0], ['user:001' => 'No such user']);
  }

}
